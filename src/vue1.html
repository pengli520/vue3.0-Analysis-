<!--
 * @Author: your name
 * @Date: 2020-12-21 16:06:44
 * @LastEditTime: 2020-12-21 16:09:40
 * @LastEditors: Please set LastEditors
 * @Description: In User Settings Edit
 * @FilePath: \vue3.0-Analysis-\src\vue1.html
-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

</body>

</html>

<script>
    const compile = {
        // dom转换虚拟dom
        domToVnode(nodeObj) {
            // console.log({...[node]}, node.attributes, node.tagName, node.textContent, node.nodeType, node.childNodes)
            return {
                type: nodeObj.tagName.toLocaleLowerCase(),
                props: this.filterProps(nodeObj.attributes),
                children: this.nodeList(nodeObj.children),
            }
        },
        nodeList(node) {
            let obj = []
            Array.from(node).forEach(item => {
                obj.push({
                    type: item.tagName.toLocaleLowerCase(),
                    props: this.filterProps(item.attributes),
                    children: item.children.length ? this.nodeList(item.children) : [item.textContent],
                })
            })
            return obj;
        },
        filterProps(NamedNodeMap) {
            let props = {};
            if (NamedNodeMap) {
                for (let item of NamedNodeMap) {
                    props[item.name] = item.value
                }
            }
            return props;
        },

        render(dom) {
            // 根据type类型来创建对应的元素
            let el = document.createElement(dom.type);

            // 再去遍历props属性对象，然后给创建的元素el设置属性
            for (let key in dom.props) {
                // 设置属性的方法
                el.setAttribute(key.replace('@', ''), dom.props[key]);
            }

            // 遍历子节点
            // // 如果子节点也是虚拟DOM，递归构建DOM节点
            // 不是就代表是文本节点，直接创建
            dom.children.forEach(child => {
                child = (child instanceof Element) || child.type ? this.render(child) : document.createTextNode(child);
                // 添加到对应元素内
                el.appendChild(child);
            });

            return el;
        }
    };
</script>